{"ast":null,"code":"import _asyncToGenerator from \"/home/jean-daniel/Documents/Projets/D\\xE9veloppement/ActivityPods/BCM/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"/home/jean-daniel/Documents/Projets/D\\xE9veloppement/ActivityPods/BCM/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"/home/jean-daniel/Documents/Projets/D\\xE9veloppement/ActivityPods/BCM/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"/home/jean-daniel/Documents/Projets/D\\xE9veloppement/ActivityPods/BCM/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar _this = this,\n  _jsxFileName = \"/home/jean-daniel/Documents/Projets/D\\xE9veloppement/ActivityPods/BCM/frontend/src/commons/ShareDialog/ShareDialog.js\";\nfunction _regeneratorRuntime() { \"use strict\"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, defineProperty = Object.defineProperty || function (obj, key, desc) { obj[key] = desc.value; }, $Symbol = \"function\" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || \"@@iterator\", asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\", toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, \"\"); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return defineProperty(generator, \"_invoke\", { value: makeInvokeMethod(innerFn, self, context) }), generator; } function tryCatch(fn, obj, arg) { try { return { type: \"normal\", arg: fn.call(obj, arg) }; } catch (err) { return { type: \"throw\", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { [\"next\", \"throw\", \"return\"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if (\"throw\" !== record.type) { var result = record.arg, value = result.value; return value && \"object\" == typeof value && hasOwn.call(value, \"__await\") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke(\"next\", value, resolve, reject); }, function (err) { invoke(\"throw\", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke(\"throw\", error, resolve, reject); }); } reject(record.arg); } var previousPromise; defineProperty(this, \"_invoke\", { value: function value(method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(innerFn, self, context) { var state = \"suspendedStart\"; return function (method, arg) { if (\"executing\" === state) throw new Error(\"Generator is already running\"); if (\"completed\" === state) { if (\"throw\" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if (\"next\" === context.method) context.sent = context._sent = context.arg;else if (\"throw\" === context.method) { if (\"suspendedStart\" === state) throw state = \"completed\", context.arg; context.dispatchException(context.arg); } else \"return\" === context.method && context.abrupt(\"return\", context.arg); state = \"executing\"; var record = tryCatch(innerFn, self, context); if (\"normal\" === record.type) { if (state = context.done ? \"completed\" : \"suspendedYield\", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } \"throw\" === record.type && (state = \"completed\", context.method = \"throw\", context.arg = record.arg); } }; } function maybeInvokeDelegate(delegate, context) { var methodName = context.method, method = delegate.iterator[methodName]; if (undefined === method) return context.delegate = null, \"throw\" === methodName && delegate.iterator.return && (context.method = \"return\", context.arg = undefined, maybeInvokeDelegate(delegate, context), \"throw\" === context.method) || \"return\" !== methodName && (context.method = \"throw\", context.arg = new TypeError(\"The iterator does not provide a '\" + methodName + \"' method\")), ContinueSentinel; var record = tryCatch(method, delegate.iterator, context.arg); if (\"throw\" === record.type) return context.method = \"throw\", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, \"return\" !== context.method && (context.method = \"next\", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = \"throw\", context.arg = new TypeError(\"iterator result is not an object\"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = \"normal\", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: \"root\" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if (\"function\" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, \"constructor\", { value: GeneratorFunctionPrototype, configurable: !0 }), defineProperty(GeneratorFunctionPrototype, \"constructor\", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, \"GeneratorFunction\"), exports.isGeneratorFunction = function (genFun) { var ctor = \"function\" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || \"GeneratorFunction\" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, \"GeneratorFunction\")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, \"Generator\"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, \"toString\", function () { return \"[object Generator]\"; }), exports.keys = function (val) { var object = Object(val), keys = []; for (var key in object) keys.push(key); return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) \"t\" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if (\"throw\" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = \"throw\", record.arg = exception, context.next = loc, caught && (context.method = \"next\", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if (\"root\" === entry.tryLoc) return handle(\"end\"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, \"catchLoc\"), hasFinally = hasOwn.call(entry, \"finallyLoc\"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error(\"try statement without catch or finally\"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, \"finallyLoc\") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && (\"break\" === type || \"continue\" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = \"next\", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if (\"throw\" === record.type) throw record.arg; return \"break\" === record.type || \"continue\" === record.type ? this.next = record.arg : \"return\" === record.type ? (this.rval = this.arg = record.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, catch: function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if (\"throw\" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error(\"illegal catch attempt\"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, \"next\" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }\nimport React, { useCallback, useState } from 'react';\nimport { useShowContext, useNotify, ListBase, useTranslate } from 'react-admin';\nimport { Button, Dialog, DialogTitle, DialogContent, DialogActions, makeStyles, useMediaQuery } from '@material-ui/core';\nimport { useCheckAuthenticated } from '@semapps/auth-provider';\nimport ContactsShareList from './ContactsShareList';\nimport { useCollection, useOutbox, ACTIVITY_TYPES } from '@semapps/activitypub-components';\nvar useStyles = makeStyles(function (theme) {\n  return {\n    dialogPaper: {\n      margin: 16\n    },\n    title: _defineProperty({\n      padding: 24\n    }, theme.breakpoints.down('sm'), {\n      padding: 16,\n      paddingBottom: 4\n    }),\n    actions: {\n      padding: 15,\n      height: 38\n    },\n    list: {\n      width: '100%',\n      maxWidth: '100%',\n      backgroundColor: theme.palette.background.paper,\n      padding: 0\n    },\n    listForm: _defineProperty({\n      paddingTop: 0,\n      paddingBottom: 0,\n      paddingRight: 0,\n      marginRight: 24,\n      height: 300\n    }, theme.breakpoints.down('sm'), {\n      padding: '0px 16px',\n      margin: 0\n    })\n  };\n});\nvar ShareDialog = function ShareDialog(_ref) {\n  var close = _ref.close,\n    resourceUri = _ref.resourceUri;\n  var classes = useStyles();\n  var _useCheckAuthenticate = useCheckAuthenticated(),\n    identity = _useCheckAuthenticate.identity;\n  var _useShowContext = useShowContext(),\n    record = _useShowContext.record;\n  var translate = useTranslate();\n  var isOrganizer = (record === null || record === void 0 ? void 0 : record['dc:creator']) === (identity === null || identity === void 0 ? void 0 : identity.id);\n  var _useCollection = useCollection(record === null || record === void 0 ? void 0 : record['apods:announces']),\n    announces = _useCollection.items;\n  var _useCollection2 = useCollection(record === null || record === void 0 ? void 0 : record['apods:announcers']),\n    announcers = _useCollection2.items;\n  var _useState = useState({}),\n    _useState2 = _slicedToArray(_useState, 2),\n    newInvitations = _useState2[0],\n    setNewInvitations = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    sendingInvitation = _useState4[0],\n    setSendingInvitation = _useState4[1];\n  var xs = useMediaQuery(function (theme) {\n    return theme.breakpoints.down('xs');\n  }, {\n    noSsr: true\n  });\n  var outbox = useOutbox();\n  var notify = useNotify();\n  var addInvitation = useCallback(function (actorUri, rights) {\n    setNewInvitations(function (prevState) {\n      var newState = _objectSpread({}, prevState);\n      newState[actorUri] = rights;\n      return newState;\n    });\n  }, [setNewInvitations]);\n  var removeInvitation = useCallback(function (actorUri) {\n    setNewInvitations(function (prevState) {\n      var newState = _objectSpread({}, prevState);\n      delete newState[actorUri];\n      return newState;\n    });\n  }, [setNewInvitations]);\n  var sendInvitations = useCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n    var actorsWithNewViewRight, actorsWithNewShareRight;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          setSendingInvitation(true);\n          actorsWithNewViewRight = Object.keys(newInvitations).filter(function (actorUri) {\n            return newInvitations[actorUri].includes('view');\n          });\n          if (!(actorsWithNewViewRight.length > 0)) {\n            _context.next = 10;\n            break;\n          }\n          if (!isOrganizer) {\n            _context.next = 8;\n            break;\n          }\n          _context.next = 6;\n          return outbox.post({\n            type: ACTIVITY_TYPES.ANNOUNCE,\n            actor: outbox.owner,\n            object: resourceUri,\n            target: actorsWithNewViewRight,\n            to: actorsWithNewViewRight\n          });\n        case 6:\n          _context.next = 10;\n          break;\n        case 8:\n          _context.next = 10;\n          return outbox.post({\n            type: ACTIVITY_TYPES.OFFER,\n            actor: outbox.owner,\n            object: {\n              type: ACTIVITY_TYPES.ANNOUNCE,\n              actor: outbox.owner,\n              object: resourceUri,\n              target: actorsWithNewViewRight\n            },\n            target: record['dc:creator'],\n            to: record['dc:creator']\n          });\n        case 10:\n          actorsWithNewShareRight = Object.keys(newInvitations).filter(function (actorUri) {\n            return newInvitations[actorUri].includes('share');\n          });\n          if (!(actorsWithNewShareRight.length > 0)) {\n            _context.next = 14;\n            break;\n          }\n          _context.next = 14;\n          return outbox.post({\n            type: ACTIVITY_TYPES.OFFER,\n            actor: outbox.owner,\n            object: {\n              type: ACTIVITY_TYPES.ANNOUNCE,\n              object: resourceUri\n            },\n            target: actorsWithNewShareRight,\n            to: actorsWithNewShareRight\n          });\n        case 14:\n          notify('app.notification.invitation_sent', 'success', {\n            smart_count: Object.keys(newInvitations).length\n          });\n          close();\n        case 16:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  })), [outbox, notify, newInvitations, isOrganizer, close, record, resourceUri, setSendingInvitation]);\n  if (!identity) return null;\n  return /*#__PURE__*/React.createElement(Dialog, {\n    fullWidth: !xs,\n    open: true,\n    onClose: close,\n    classes: {\n      paper: classes.dialogPaper\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(DialogTitle, {\n    className: classes.title,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 7\n    }\n  }, translate('app.action.share_event')), /*#__PURE__*/React.createElement(DialogContent, {\n    className: classes.listForm,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(ListBase, {\n    resource: \"Profile\",\n    basePath: \"/Profile\",\n    perPage: 1000,\n    sort: {\n      field: 'vcard:given-name',\n      order: 'ASC'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(ContactsShareList, {\n    addInvitation: addInvitation,\n    removeInvitation: removeInvitation,\n    announces: announces,\n    announcers: announcers,\n    isOrganizer: isOrganizer,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(DialogActions, {\n    className: classes.actions,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"text\",\n    size: \"medium\",\n    onClick: close,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 9\n    }\n  }, translate('ra.action.close')), Object.keys(newInvitations).length > 0 && /*#__PURE__*/React.createElement(Button, {\n    variant: \"contained\",\n    color: \"primary\",\n    size: \"medium\",\n    onClick: sendInvitations,\n    disabled: sendingInvitation,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 11\n    }\n  }, translate('app.action.send_invitation', {\n    smart_count: Object.keys(newInvitations).length\n  }))));\n};\nexport default ShareDialog;","map":{"version":3,"names":["React","useCallback","useState","useShowContext","useNotify","ListBase","useTranslate","Button","Dialog","DialogTitle","DialogContent","DialogActions","makeStyles","useMediaQuery","useCheckAuthenticated","ContactsShareList","useCollection","useOutbox","ACTIVITY_TYPES","useStyles","theme","dialogPaper","margin","title","padding","breakpoints","down","paddingBottom","actions","height","list","width","maxWidth","backgroundColor","palette","background","paper","listForm","paddingTop","paddingRight","marginRight","ShareDialog","close","resourceUri","classes","identity","record","translate","isOrganizer","id","announces","items","announcers","newInvitations","setNewInvitations","sendingInvitation","setSendingInvitation","xs","noSsr","outbox","notify","addInvitation","actorUri","rights","prevState","newState","removeInvitation","sendInvitations","actorsWithNewViewRight","Object","keys","filter","includes","length","post","type","ANNOUNCE","actor","owner","object","target","to","OFFER","actorsWithNewShareRight","smart_count","field","order"],"sources":["/home/jean-daniel/Documents/Projets/Développement/ActivityPods/BCM/frontend/src/commons/ShareDialog/ShareDialog.js"],"sourcesContent":["import React, { useCallback, useState } from 'react';\nimport { useShowContext, useNotify, ListBase, useTranslate } from 'react-admin';\nimport {\n  Button,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  makeStyles,\n  useMediaQuery,\n} from '@material-ui/core';\nimport { useCheckAuthenticated } from '@semapps/auth-provider';\nimport ContactsShareList from './ContactsShareList';\nimport { useCollection, useOutbox, ACTIVITY_TYPES } from '@semapps/activitypub-components';\n\nconst useStyles = makeStyles((theme) => ({\n  dialogPaper: {\n    margin: 16,\n  },\n  title: {\n    padding: 24,\n    [theme.breakpoints.down('sm')]: {\n      padding: 16,\n      paddingBottom: 4,\n    },\n  },\n  actions: {\n    padding: 15,\n    height: 38,\n  },\n  list: {\n    width: '100%',\n    maxWidth: '100%',\n    backgroundColor: theme.palette.background.paper,\n    padding: 0,\n  },\n  listForm: {\n    paddingTop: 0,\n    paddingBottom: 0,\n    paddingRight: 0,\n    marginRight: 24,\n    height: 300,\n    [theme.breakpoints.down('sm')]: {\n      padding: '0px 16px',\n      margin: 0,\n    },\n  },\n}));\n\nconst ShareDialog = ({ close, resourceUri }) => {\n  const classes = useStyles();\n  const { identity } = useCheckAuthenticated();\n  const { record } = useShowContext();\n  const translate = useTranslate();\n  const isOrganizer = record?.['dc:creator'] === identity?.id;\n  const { items: announces } = useCollection(record?.['apods:announces']);\n  const { items: announcers } = useCollection(record?.['apods:announcers']);\n  const [newInvitations, setNewInvitations] = useState({});\n  const [sendingInvitation, setSendingInvitation] = useState(false);\n  const xs = useMediaQuery((theme) => theme.breakpoints.down('xs'), { noSsr: true });\n  const outbox = useOutbox();\n  const notify = useNotify();\n\n  const addInvitation = useCallback(\n    (actorUri, rights) => {\n      setNewInvitations((prevState) => {\n        const newState = { ...prevState };\n        newState[actorUri] = rights;\n        return newState;\n      });\n    },\n    [setNewInvitations]\n  );\n\n  const removeInvitation = useCallback(\n    (actorUri) => {\n      setNewInvitations((prevState) => {\n        const newState = { ...prevState };\n        delete newState[actorUri];\n        return newState;\n      });\n    },\n    [setNewInvitations]\n  );\n\n  const sendInvitations = useCallback(async () => {\n    setSendingInvitation(true);\n    const actorsWithNewViewRight = Object.keys(newInvitations).filter((actorUri) =>\n      newInvitations[actorUri].includes('view')\n    );\n    if (actorsWithNewViewRight.length > 0) {\n      if (isOrganizer) {\n        await outbox.post({\n          type: ACTIVITY_TYPES.ANNOUNCE,\n          actor: outbox.owner,\n          object: resourceUri,\n          target: actorsWithNewViewRight,\n          to: actorsWithNewViewRight,\n        });\n      } else {\n        // Offer the organizer to invite these people\n        await outbox.post({\n          type: ACTIVITY_TYPES.OFFER,\n          actor: outbox.owner,\n          object: {\n            type: ACTIVITY_TYPES.ANNOUNCE,\n            actor: outbox.owner,\n            object: resourceUri,\n            target: actorsWithNewViewRight,\n          },\n          target: record['dc:creator'],\n          to: record['dc:creator'],\n        });\n      }\n    }\n\n    const actorsWithNewShareRight = Object.keys(newInvitations).filter((actorUri) =>\n      newInvitations[actorUri].includes('share')\n    );\n    if (actorsWithNewShareRight.length > 0) {\n      await outbox.post({\n        type: ACTIVITY_TYPES.OFFER,\n        actor: outbox.owner,\n        object: {\n          type: ACTIVITY_TYPES.ANNOUNCE,\n          object: resourceUri,\n        },\n        target: actorsWithNewShareRight,\n        to: actorsWithNewShareRight,\n      });\n    }\n\n    notify('app.notification.invitation_sent', 'success', { smart_count: Object.keys(newInvitations).length });\n    close();\n  }, [outbox, notify, newInvitations, isOrganizer, close, record, resourceUri, setSendingInvitation]);\n\n  if (!identity) return null;\n\n  return (\n    <Dialog fullWidth={!xs} open={true} onClose={close} classes={{ paper: classes.dialogPaper }}>\n      <DialogTitle className={classes.title}>{translate('app.action.share_event')}</DialogTitle>\n      <DialogContent className={classes.listForm}>\n        <ListBase\n          resource=\"Profile\"\n          basePath=\"/Profile\"\n          perPage={1000}\n          sort={{ field: 'vcard:given-name', order: 'ASC' }}\n        >\n          <ContactsShareList\n            addInvitation={addInvitation}\n            removeInvitation={removeInvitation}\n            announces={announces}\n            announcers={announcers}\n            isOrganizer={isOrganizer}\n          />\n        </ListBase>\n      </DialogContent>\n      <DialogActions className={classes.actions}>\n        <Button variant=\"text\" size=\"medium\" onClick={close}>\n          {translate('ra.action.close')}\n        </Button>\n        {Object.keys(newInvitations).length > 0 && (\n          <Button variant=\"contained\" color=\"primary\" size=\"medium\" onClick={sendInvitations} disabled={sendingInvitation}>\n            {translate('app.action.send_invitation', { smart_count: Object.keys(newInvitations).length })}\n          </Button>\n        )}\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default ShareDialog;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}